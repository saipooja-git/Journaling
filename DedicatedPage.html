<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>My Diary â€“ Post</title>

  <link rel="stylesheet" href="./DedicatedPage.css" />
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT"
    crossorigin="anonymous"
  />
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    .post-card { max-width: 900px; width: 100%; border-radius: 1rem; }
    pre.wrap { white-space: pre-wrap; word-wrap: break-word; }
  </style>
</head>

<body class="container d-flex flex-column align-items-center py-4">
  <div class="w-100 d-flex justify-content-between align-items-center mb-3" style="max-width: 900px">
    <a href="./FeedPage.html" class="btn btn-link ps-0">&larr; Back to Feed</a>
    <a href="./Post.html" class="btn btn-primary">New Post</a>
  </div>

  <div id="status" class="text-muted mb-3 w-100" style="max-width: 900px">Loading...</div>

  <div id="post" class="post-card card p-4 shadow-sm w-100"></div>

  <script
    src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
    integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
    crossorigin="anonymous"
  ></script>
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.min.js"
    integrity="sha384-RuyvpeZCxMJCqVUGFI0Do1mQrods/hhxYlcVfGPOfQtPJh0JCw12tUAZ/Mv10S7D"
    crossorigin="anonymous"
  ></script>

  <script>
    // Match Feed/Post pages
    const API_BASE = "http://localhost:3000";

    const qsId = () => new URL(location.href).searchParams.get("id");

    function escapeHTML(str = "") {
      return String(str)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#39;");
    }

    async function loadPost() {
      const id = qsId();
      const status = document.getElementById("status");
      const container = document.getElementById("post");

      if (!id) {
        status.textContent = "No post id provided.";
        return;
      }

      status.textContent = "Loading...";
      container.innerHTML = "";

      try {
        const resp = await fetch(`${API_BASE}/postById?id=${encodeURIComponent(id)}`);
        if (!resp.ok) {
          status.textContent = `Failed to load post (${resp.status}).`;
          return;
        }
        const p = await resp.json();
        status.textContent = "";

        const title = escapeHTML(p.postTitle || "(Untitled)");
        const bodySafe = escapeHTML(p.postDescription || "");

        container.innerHTML = `
          <h2 class="mb-3">${title}</h2>
          <pre class="wrap fs-5 mb-0">${bodySafe}</pre>
        `;
      } catch (e) {
        console.error(e);
        status.textContent = "Network error.";
      }
    }

    document.addEventListener("DOMContentLoaded", loadPost);
  </script>
</body>
</html>
